% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SSRTE_simstudy.R
\name{SSRTE_simstudy}
\alias{SSRTE_simstudy}
\title{Simulation study for sample size re-estimation using a totality of evidence approach}
\usage{
SSRTE_simstudy(
  nsim,
  alpha,
  beta,
  n_endpts,
  allocate_rate,
  mean_cohen_d_truth,
  mu_ct,
  sd,
  rho,
  timing_interim,
  initial_tot_ss = TRUE,
  exp_mean_cohen_d_at_planning = NULL,
  tot_ss_ct = NULL,
  SSR_type,
  global_test_type,
  max_ss_index,
  seed1,
  seed2,
  seed_PM = 1,
  nPM = 100
)
}
\arguments{
\item{nsim}{Number of simulated trials.}

\item{alpha}{One-sided alpha}

\item{beta}{Type II error rate (\eqn{\beta}). (for power / CP).}

\item{n_endpts}{Number of endpoints.}

\item{allocate_rate}{Treatment:control allocation ratio.}

\item{mean_cohen_d_truth}{True mean Cohen's d across endpoints used to simulate data.}

\item{mu_ct}{Mean vector for the control group (length = \code{n_endpts}).}

\item{sd}{Standard deviations for each endpoint (length = \code{n_endpts}).}

\item{rho}{Correlation matrix for the endpoints.}

\item{timing_interim}{Planned interim timing (information fraction).}

\item{initial_tot_ss}{Logical. If \code{TRUE}, compute initial sample sizes
via \code{get_initial_tot_ss()}; if \code{FALSE}, use \code{tot_ss_ct}.}

\item{exp_mean_cohen_d_at_planning}{Expected mean Cohen's d at planning;
required when \code{initial_tot_ss = TRUE}.}

\item{tot_ss_ct}{Optional fixed total control sample size
(used only when \code{initial_tot_ss = FALSE}).}

\item{SSR_type}{\code{"SSR-Power"}, \code{"SSR-CP"}, or \code{"No SSR"}.}

\item{global_test_type}{\code{"exact OLS"} or \code{"Permutation"}.}

\item{max_ss_index}{Maximum inflation factor for SSR
(e.g., 2 means the sample size can at most be doubled relative to the
original plan).}

\item{seed1}{Base seed for stage-1 simulations.}

\item{seed2}{Base seed for stage-2 simulations.}

\item{seed_PM}{Base seed for Permutation. Default seed: 1.}

\item{nPM}{Number of permutations for the permutation test. Default: 100.}
}
\value{
A list with
\itemize{
\item \code{interim_analysis}: tibble with one row per simulation
\item \code{final_analysis}: tibble with one row per simulation that got to final
\item \code{proportion_of_rejection}: overall rejection proportion (i.e., type I error or power)
}
}
\description{
This runs \code{nsim} simulated two-stage trials. For each replicate it:
\enumerate{
\item optionally computes the \emph{initial} (planned) sample size using
\code{get_initial_tot_ss()},
\item generates stage-1 data,
\item runs \code{interim_analysis()},
\item if the trial stops for efficacy, records that and moves on,
\item otherwise generates stage-2 data according to the re-estimated sizes and
runs \code{final_analysis()},
\item records whether H0 was rejected (can be rejected at either the interim or
final analysis).
}
}
\details{
The returned object contains per-replicate interim and final summaries and
the overall proportion of rejections.

This function calls the following in-package functions:
\itemize{
\item \code{simulate_example_one_stage_data()}
\item \code{get_initial_tot_ss()}
\item \code{interim_analysis()}
\item \code{final_analysis()}
}
}
\examples{
nsim <- 1e3
alpha <- 0.025
beta  <- 0.2
n_endpts <- 6
allocate_rate <- 1
mean_cohen_d_truth <- 0.25
timing_interim <- 2/3
max_ss_index <- 2

mu_ct <- c(4, 6, 4, 5, 7, 6)
sd <- c(0.5, 0.5, 1, 1, 2, 2)
rho <- matrix(c(
  1.0, 0.1, 0.3, 0.7, 0.1, 0.3,
  0.1, 1.0, 0.7, 0.1, 0.3, 0.7,
  0.3, 0.7, 1.0, 0.1, 0.3, 0.7,
  0.7, 0.1, 0.1, 1.0, 0.1, 0.3,
  0.1, 0.3, 0.3, 0.1, 1.0, 0.7,
  0.3, 0.7, 0.7, 0.3, 0.7, 1.0
), nrow = 6, byrow = TRUE)

SSR_type <- "SSR-Power"
global_test_type <- "exact OLS"

seed1 <- 51
seed2 <- 82

# at planning, we thought exp_mean_cohen_d = 0.3
exp_mean_cohen_d_at_planning <- 0.3

res <- SSRTE_simstudy(
  nsim = nsim,
  alpha = alpha,
  beta = beta,
  n_endpts = n_endpts,
  allocate_rate = allocate_rate,
  mean_cohen_d_truth = mean_cohen_d_truth,
  mu_ct = mu_ct,
  sd = sd,
  rho = rho,
  timing_interim = timing_interim,
  initial_tot_ss = TRUE,
  exp_mean_cohen_d_at_planning = exp_mean_cohen_d_at_planning,
  SSR_type = SSR_type,
  global_test_type = global_test_type,
  max_ss_index = max_ss_index,
  seed1 = seed1,
  seed2 = seed2
)

res

}
